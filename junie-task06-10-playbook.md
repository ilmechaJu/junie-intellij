# Junie Task 06~10 플레이북

이 문서는 Junie를 현업에서 자주 활용되는, 프로젝트를 수행하기 위한 실전 프롬프트 가이드이자 체크리스트입니다.

- [공통 운영 규칙](#common-rules) 공통 운영 규칙을 통해, 팀/개인 모두가 동일한 방식으로 요청·피드백·반복 루프를 돌릴 수 있도록, 
공통 규칙을 설정하는 법을 익힐 수 있습니다.
- [task06~task10](#tasks-06-10)을 통해서는, junie를 고급활용 해볼 수 있는 프로젝트를 진행합니다.


## 문서 배치/구조
- 본 파일 위치: 루트 `junie-task06-10-playbook.md` (필요 시 `README.md`에서 링크)
- 각 Task 디렉토리: `/task06`, `/task07`, `/task08`, `/task09`, `/task10`
  - 각 폴더에 `README.md`, 산출물(코드/테스트/다이어그램/스펙), CI 스크립트
- 공통 문서 템플릿(이미 포함)
  - `docs/adr/ADR-YYYYMMDD-<title>.md`
  - `docs/impact/IMPACT-task-template.md`
  - `docs/migrations/MIG-template.md`


<a id="common-rules"></a>

## 공통 운영 규칙
- 브랜치: `main`(완료물), `feat/task-0X-<short-title>`(작업)
- 태그/릴리즈: 각 Task 마무리 시 `v0X.0.0` 태그와 릴리즈 노트(사용자 영향/마이그레이션/롤백 포함)
- 품질 루브릭: 테스트 커버리지/성능/보안/가용성 지표 목표 설정 및 충족
- CI/CD: 빌드·테스트·린트·스캔 자동화, 문서와 코드 동기화 검증

## Junie와 잘 일하는 6가지 원칙
1. 역할 고정: 요청 앞에 역할을 명시해 컨텍스트 고정 (예: "아키텍트 모드", "보안 분석가 모드")
2. 출력 제약: 원하는 형식·범위·예시 수량을 구체화 (예: Top-5 표, O 표기, ASCII 다이어그램)
3. 근거/트레이드오프 요구: 가정·제약·대안 비교를 표로 요청
4. 반복 루프: 산출물 → 실행 결과 → 피드백 → 수정 제안 → 적용을 짧게 반복
5. 레일 깔기: 디렉토리/템플릿/체크리스트를 먼저 고정 후 작업 지시
6. Drift 방지: 스펙↔코드, 문서↔테스트 동기화 체크를 프롬프트에 포함

## 공통 프롬프트 템플릿
### 킥오프 템플릿
```
컨텍스트: <레포/스택/목표/기한>
역할: <아키텍트|성능|보안|릴리즈 매니저>
산출물: <파일/코드/다이어그램/테스트/CI>
제약: <언어/런타임/툴/OS/네이밍>
체크리스트: <측정지표/품질루브릭>
출력형식: <목차/표/코드블록/ASCII>
요청: 위 조건으로 작업 계획과 첫 커밋 단위를 제시해줘.
```

### 리뷰/수정 템플릿
```
다음 산출물에 대한 리뷰와 수정을 제안해줘. 기준: <커버리지80%|RFC7807|p95 개선 등>.
변경사항을 diff 스타일로 요약해줘.
```

### 증거/테스트 템플릿
```
이 변경이 목표 지표를 충족하는지 검증 스크립트/테스트를 생성하고,
실패 시 메시지를 구체화해줘.
```

## 문서 템플릿 스니펫
### ADR 요약
```
Title: <의사결정 제목>
Context: <배경/문제/제약>
Options: <A/B/C 장단점>
Decision: <선택/근거>
Consequences: <부채/리스크/마이그레이션>
```

### PR 설명 요약
```
목적/배경
주요 변경(코드/스키마/구성)
테스트(추가/수정/커버리지)
성능 영향
보안 영향
마이그레이션/롤백
스크린샷/다이어그램
```

### RFC 7807 에러 예시(JSON)
```json
{
  "type": "https://example.com/probs/invalid-input",
  "title": "Invalid input",
  "status": 400,
  "detail": "name must not be blank",
  "instance": "/api/v1/items/123"
}
```

---

<a id="tasks-06-10"></a>

## Task 06 — 레거시 리팩터링 & 회귀 테스트: 대화형 가이드
### 목표 프롬프트(킥오프)
```
아키텍트 모드. 레거시 모듈의 public API, 전역 상태, 순환 의존 경로를 요약해줘.
끊는 전략(인터페이스 분리/이벤트 발행)과 변경 영향(호환성/성능/테스트)을 제안하고,
변경 전/후 의존성 다이어그램을 ASCII로. Golden Test 계획과 CI 단계도 포함.
출력: 체크리스트 + 단계별 PR 단위 + 폴더 구조(/task06/...).
```

### 분석 루프 프롬프트
```
다음 소스 목록에서 사이드이펙트/전역 상태/순환 의존을 표시하고 근거를 달아줘: <파일 경로들>.
각 항목마다 분리 전략과 예상 리스크, 테스트 포인트를 표로 요약.
```

### 골든 테스트 확보
```
기존 동작 스냅샷을 위한 Golden Test를 생성해줘. 입력/출력 케이스 Top-20를 추천하고 고정(seed 포함).
테스트는 격리 가능(파일/시간/랜덤)해야 하며, 실패 시 원인 분류 메시지를 생성.
```

### Deprecated/호환 레이어
```
파괴적 변경을 최소화하기 위한 Deprecated shim API 설계를 제안해줘. 유지 기간, 로그 경고 포맷,
마이그레이션 가이드 목차와 코드 예시를 포함.
```

### 산출물 체크리스트
- 순환 의존 제거, 사이드이펙트 캡슐화, public API 축소
- Golden Test + 단위/통합(커버리지 80%+)
- CI 회귀 워크플로우(`/task06/ci/*`)
- 마이그레이션/Deprecated 안내, 의존성 다이어그램

### ASCII 다이어그램 요청 예
```
변경 전/후 모듈 의존성 ASCII 다이어그램을 30줄 이내로 요약해줘. 사이클은 🔁, 경계는 [ ] 로 표기.
```

---

## Task 07 — Contract-first API: 대화형 가이드
### 스펙 중심 킥오프
```
아키텍트 모드. 이 도메인의 OpenAPI 스펙 스켈레톤을 작성해줘.
요구: 공통 에러 모델(RFC7807), 인증/인가 스킴, 재시도 정책 헤더, idempotency 키.
출력: /task07/spec/openapi.yaml, 주석 강화, 샘플 요청/응답 예제 포함.
```

### 서버/SDK/계약 테스트 생성
```
스펙에서 서버 스텁과 타입 안전 클라이언트 SDK를 생성하는 계획을 제시해줘.
언어/프레임워크/패키징/버전 전략과 예제 코드, CI에서 스펙-코드 drift 0 검사를 포함해.
Pact 또는 Schemathesis 기반 계약 테스트 시나리오(happy/edge/failure) 스크립트를 생성.
```

### 에러/재시도 정책 구체화
```
각 엔드포인트에 대해 표준화된 에러 응답과 재시도 가능/불가 조건을 표로 정리하고,
429/503 백오프 정책과 idempotency 처리 흐름을 시퀀스 다이어그램(ASCII)으로 그려줘.
```

### 체크리스트
- 스펙↔구현 drift 0
- 에러 응답 표준화 및 재시도 정책 정의
- 계약 테스트 CI 통과 및 샌드박스 예제 동작

---

## Task 08 — 성능 병목/프로파일링/개선: 대화형 가이드
### 병목 추정 킥오프
```
성능 엔지니어 모드. 샘플 로그/데이터 분포를 분석해 Top-N hot path를 추정해줘.
각 후보에 대해 Trie vs HashMap 등 대안의 시간/공간 복잡도, 캐시 친화성, 병렬화 난이도를 표로.
성능 목표: p95 -30%, 메모리 피크 -20%.
```

### 벤치/로드 스크립트 생성
```
재현 가능한 마이크로벤치마크와 로드 테스트 스크립트를 만들어줘. 고정 seed, 워밍업, GC 옵션 명시.
출력: /task08/bench/, /task08/scripts/, 결과 수집 파서와 그래프 생성 스크립트 포함.
```

### 변경/검증 루프
```
후보 알고리즘 A/B/C의 구현 스케치와 측정 계획을 제시하고,
변경 전/후 지표 비교 표와 신뢰구간 표기를 포함. 회귀 방지 GitHub Actions 워크플로우도 제공.
```

### 체크리스트
- p95/p99 레이턴시 개선 목표 달성
- 메모리 피크 감소 및 회귀 없음
- 재현 가능한 벤치마크 및 결과 문서화

---

## Task 09 — 보안 하드닝/DevSecOps: 대화형 가이드
### 위협 모델링 킥오프
```
보안 분석가 모드. STRIDE 기반으로 자산/행위자/공격 벡터/우선순위를 표로 작성해줘.
위험도 계산식과 가정 명시. DFD(ASCII)와 신뢰경계 표시.
```

### 정적/동적/의존성/시크릿 스캐닝 파이프라인
```
SAST/DAST/Dependency Audit/Secret Scanning을 CI에 통합하는 계획과 YML 예시를 생성해줘.
pre-commit 훅과 정책(deny patterns, commit msg 규칙), 예외 승인 절차를 포함.
```

### 취약 패턴 제거 PR 가이드
```
코드베이스의 입력 검증 약한 경로를 찾아 STRIDE 기준 위협과 완화책을 제안해줘.
각 항목별 단위/통합 테스트 케이스와 보안 가드레일 코드를 생성.
```

### 체크리스트
- 입력 검증 강화 및 위험 경로 테스트
- 취약 라이브러리 업데이트 및 호환성 검증
- 시크릿 유출 방지 정책 적용

---

## Task 10 — E2E 기능 제공: 대화형 가이드
### 전체 설계 킥오프
```
프로덕트/아키텍트 모드. 신규 기능을 Epic→Story→Task로 분해하고 RACI/마일스톤을 제시해줘.
데이터 모델/마이그레이션, API/UI 설계, 관측성 지표(SLO), 릴리즈/롤백 시나리오를 포함.
출력: /task10/backend|frontend|observability|docs 구조와 초기 스켈레톤 파일 목록.
```

### 개발/테스트/관측성 루프
```
단위/통합/E2E 테스트 전략을 제시하고, 대시보드와 알림 규칙을 정의해줘.
릴리즈 노트 템플릿과 데이터 백필 스크립트 예시를 생성.
```

### 장애 없는 마이그레이션/롤백
```
트렁크 기반 릴리즈 플로우에서의 롤링 배포/리드레플리카/피처플래그/DB 단계적 마이그레이션 전략을
체크리스트로 만들고, 샌드박스 검증 절차를 문서화해줘.
```

### 체크리스트
- 무중단 마이그레이션/롤백 검증, 데이터 백필 스크립트
- SLO 정의 및 준수, 관측성/알림 구성
- 사용자 영향/호환성 주의가 릴리즈 노트에 명확

---

## 공통 체크리스트(모든 Task)
- [ ] 문제 정의 및 성공 기준(측정 가능한 지표) 명시
- [ ] ADR 1건 이상 및 대안 비교
- [ ] 단위/통합/필요 시 e2e 테스트 추가
- [ ] CI 빌드/테스트/린트 통과
- [ ] 보안/품질 스캔 수행 및 결과 기록
- [ ] 성능 영향(있다면) 전/후 비교 공개
- [ ] 릴리즈 노트 및 롤백 절차 문서화

## 폴더 구조 예시 스캐폴딩
```
/task06
  README.md
  /diagrams
  /tests
  /ci
/task07
  /spec
  /server
  /sdk
  /tests-contract
/task08
  /profile
  /bench
  /scripts
/task09
  /threat-model
  /ci-security
  /policies
/task10
  /backend
  /frontend
  /observability
  /docs
/docs
  /adr
  /impact
  /migrations
```

## CI 스니펫(예시) 및 Windows 명령
### GitHub Actions
```yaml
name: ci
on: [push, pull_request]
jobs:
  build-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'temurin'
      - name: Build
        run: ./gradlew build --no-daemon
      - name: Test
        run: ./gradlew test --no-daemon
```

### Windows 로컬 명령
```
빌드: gradlew.bat build
테스트만: gradlew.bat test
```

## “좋은 프롬프트” 체크리스트
- [ ] 역할과 목표 지표가 수치로 명시되었는가?
- [ ] 입력 제약(언어/프레임워크/경로/OS)이 명확한가?
- [ ] 산출물 형식과 예제 개수, 검증 기준을 지정했는가?
- [ ] 대안 비교/트레이드오프/가정이 요청되었는가?
- [ ] 반복 루프(리뷰→수정) 지시가 포함되었는가?
- [ ] 실패 시 재시도/롤백/로그 포맷까지 고려했는가?

## 자주 쓰는 “한 줄 스니펫”
- 구조 고정: `출력은 섹션별 목차와 코드블록만 사용. 120자 줄바꿈.`
- 표 강제: `각 항목을 열: 가정|장점|단점|리스크|테스트포인트 로 표기.`
- 다이어그램: `ASCII 의존성/시퀀스 다이어그램, 30줄 이하.`
- 근거: `선택 사유를 정량/정성 근거로 3개 이상.`
- 품질 게이트: `커버리지 80% 미만 시 실패.`

## 트러블슈팅용 프롬프트
- 결과가 장황할 때: `Top-5만. 불릿 7개 이하.`
- 맥락 이탈: `이전 합의(…링크) 기준으로만 업데이트.`
- 코드 불일치: `스펙↔코드 drift 검사 목록 생성.`
- 테스트 플래키: `비결정 요인(시간/랜덤/파일) 제거 체크리스트.`

---

## 시작하기(실행 순서)
1) 진행할 Task 디렉토리를 생성하고 각 `README.md`에 목표/지표/일정을 작성합니다.
2) 본 문서의 체크리스트/템플릿을 복사하여 초기화를 완료합니다.
3) 작은 단위로 PR을 올리고, CI로 검증 루프를 짧게 유지합니다.
4) 산출물(문서/다이어그램/스크립트)을 디렉토리 내에 함께 커밋합니다.

